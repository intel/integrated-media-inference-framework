cmake_minimum_required(VERSION 2.8.2)

include(ExternalProject)

ExternalProject_Add(${EXT_PRJ_NAME}

  # Clonse the repo
  GIT_REPOSITORY "${EXT_PRJ_REPO}"
  GIT_TAG "${EXT_PRJ_TAG}"
  GIT_PROGRESS 1
  
  # No special commands
  UPDATE_COMMAND ""
  PATCH_COMMAND ""
  TEST_COMMAND ""
  INSTALL_COMMAND ""

  # CMake arguments
  CMAKE_ARGS -DCMAKE_INSTALL_PREFIX=${EXT_PRJ_INSTALL_DIR} 
    -DCMAKE_INSTALL_LIBDIR=${CMAKE_INSTALL_LIBDIR}
    -DCMAKE_PREFIX_PATH=${CMAKE_PREFIX_PATH}
    -DCMAKE_BUILD_TYPE=Release
    -DgRPC_BUILD_CSHARP_EXT=OFF
    -DgRPC_INSTALL=ON 
    -DgRPC_BUILD_TESTS=OFF
    -DBUILD_SHARED_LIBS=ON
    -DgRPC_PROTOBUF_PROVIDER:STRING=package
    -DgRPC_PROTOBUF_PACKAGE_TYPE:STRING=CONFIG
    -DProtobuf_DIR:PATH=${PROTOBUF_CMAKE_DIR}
    -DgRPC_ZLIB_PROVIDER=package 
    -DgRPC_CARES_PROVIDER=package 
    -DgRPC_SSL_PROVIDER=package 

  # Custom build & install commands
  BUILD_COMMAND make -j
  COMMAND make install
)
